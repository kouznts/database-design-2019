# Проектирование баз данных (2019)

1. [Лабораторная работа №1](#lab1)
2. [Лабораторная работа №2](#lab2)
3. [Лабораторная работа №3](#lab3)
4. [Лабораторная работа №4](#lab4)
5. [Лабораторная работа №5](#lab5)
6. [Распределённая обработка данных в современных СУБД](#lab6)

## Лабораторная работа №1. Логическое проектирование баз данных <a name="lab1"></a>
Приобретение навыков анализа и моделирования предметной области, построение структурированных наборов данных в рамках реляционной модели данных. Приобретение навыков нормализации отношений.
### Предметная область
База данных, поддерживающая информационную систему аэропорта.
### Основные предметно-значимые сущности
Член экипажа, Экипаж, Самолёт, Рейс, Кассир, Билет, Пассажир.
### Основные предметно-значимые атрибуты сущностей
1. Член экипажа: Табельный номер, ФИО, Количество вылетов, Должность, Номер экипажа, Группа допуска.
2. Экипаж: Номер экипажа, Группа допуска.
3. Самолёт: Бортовой номер, Модель.
4. Модель: Группа допуска, Скорость, Потолок, Взлётная масса, Количество посадочных мест, Топливо, Длина разбега.
5. Рейс: Номер рейса, Место назначения, Дата вылета, Дата прибытия, Бортовой номер.
6. Кассир: Табельный номер_кассира, ФИО.
7. Билет: Номер билета, Цена, Табельный номер кассира, Серия и номер паспорта пассажира, Номер рейса.
8. Пассажир: Серия и номер паспорта пассажира, ФИО пассажира.
### Основные требования к функциям системы
В зависимости от марки самолета выбирается экипаж, имеющий соответствующую группу допуска управления воздушным судном. Для диспетчерской службы важным является номер экипажа. Каждый экипаж состоит из нескольких человек, каждый из которых имеет личные данные и должность. На определенный срок диспетчеры составляют плановое расписание полетов самолетов. Расписание составляется не только для диспетчерской службы аэропорта, но и для информационного обеспечения потенциальных пассажиров. Чтобы обладать достаточной информативностью для пользователей в расписание должны входить следующие данные: номер рейса, название рейса, день вылета, время вылета, время прибытия.

Непосредственная динамическая информация о состоянии полета воздушных судов по заданным направлениям должна аккумулироваться и предоставляться пользователям в наглядной и информационно полной форме. Для предоставления таких услуг со стороны БД необходимо содержание в ней отношения «Вылеты», содержащего следующие атрибуты: Код вылета, код экипажа, номер рейса, код самолета, день вылета.
### Ограничения целостности данных
1. ФИО (фамилия, имя, отчество): три слова, в них могут содержаться только русские буквы и дефис.
2. Все номера: числа от 10000 до 99999.
3. Количество вылетов: положительное целое число.
4. Должность: одна из следующих — командир или второй пилот.
5. Модель: строка.
6. Скорость: измеряется в км/ч, положительное число.
7. Высота: измеряется в м, положительное число.
8. Взлётная масса: измеряется в кг, положительное число.
9. Количество посадочных мест: положительное целое число.
10. Топливо: строка.
11. Длина разбега: измеряется в м, положительное число.
12. Место назначения: строка.
13. Дата: дата.
14. Цена: положительное целое число.
15. Серия и номер паспорта: десятизначное число от 1000000000 до 9999999999.
### Связи
1. Член экипажа и Экипаж – M:1.
2. Экипаж и Рейс – 1:M.
3. Модель и Самолёт – 1:1.
4. Самолёт и Рейс – 1:M.
5. Кассир и Билет – 1:M.
6. Пассажир и Билет – 1:M.
### Логическая и физическая модель предметной области
<img src="/images/Рисунок 1 – Логическая и физическая модель предметной области.png" alt="Рисунок 1 – Логическая и физическая модель предметной области"/>

### Функциональные зависимости
Для простоты будем считать, что ФИО и Серия и номер паспорта пассажира являются атомарными атрибутами.
1. Табельный номер → ФИО, Количество вылетов, Должность, Номер экипажа, Группа допуска.
2. Номер экипажа → Группа допуска.
3. Номер рейса → Номер экипажа, Место назначения, Дата вылета, Дата прибытия, Бортовой номер.
4. Бортовой номер → Модель.
5. Модель → Группа допуска, Топливо, Длина разбега, Взлётная масса, Потолок, Количество посадочных мест, Скорость.
6. Табельный номер кассира → ФИО кассира.
7. Номер билета → Цена, Табельный номер кассира, Серия и номер паспорта пассажира, Номер рейса.
8. Серия и номер паспорта пассажира → ФИО пассажира.

Заметим, что все существующие зависимости являются функционально полными и нет частичных и транзитивных зависимостей.

В отношениях значения, определяемые каждым атрибутом, являются атомарными, каждый неключевой атрибут функционально полно зависит от первичного ключа, каждый неключевой атрибут нетранзитивно зависит от первичного ключа – эти отношения находятся в 3-ей нормальной форме.

## Лабораторная работа №2. Создание таблиц и ограничений целостности. Использование команд SQL для работы с данными, хранящимися в таблицах <a name="lab2"></a>
Знакомство с возможностями СУБД по созданию таблиц. Приобретение практических навыков использования языка SQL.
### Порядок выполнения работы
1. Выберите необходимую СУБД, для которой нужно создать схему данных.
2. Внесите необходимые изменения в имена таблиц, полей, связей и их свойства.
3. Проверьте и внесите необходимые изменения в типы данных полей.
4. Проверьте и внесите необходимые изменения в ограничения целостности данных.
5. Сгенерируйте DDL-скрипт для создания схемы данных в выбранной СУБД.
6. Внесите необходимые изменения в созданный DDL-скрипт.
7. Выполните DDL-скрипт и заполните созданные таблицы данными командой SQL Insert (минимум 10 записей на таблицу).
8. Создайте необходимые SQL-запросы, выполняющие основные требования к функциям системы.
9. Обдумайте и создайте запросы, которые, возможно, будут полезными для будущих пользователей вашей базы данных.
10. Приведите примеры запросов с выборкой, сортировкой, группировкой, левым, правым и внешним объединением.
11. Оформите отчет о выполнении лабораторной работы.
### SQL-запросы
1. Выдать расписание аэропорта на определённую дату.
2. Выдать список самолетов, имеющих более 200 посадочных мест.
3. В связи c участившимися террористическими актами для охранных служб аэропорта создаётся запрос на выборку, в котором отражается информация о том, сколько и кому каждый кассир продал билетов на какой рейс.
4. Выдать информацию об экипаже, назначенном на определённый рейс.
5. Выдать список самолётов, совершивших полёты в определённый день.
6. Выдать список всех направлений, по которым осуществляются авиаперевозки.
7. Расписание для информационного табло аэропорта.
8. Для обслуживания самолёта.
9. Для службы безопасности.
10. Вывести список моделей самолетов и их вместимость в порядке убывания вместимости.
11. Вывести фамилии пилотов, у которых количество вылетов больше 50 и упорядочить по фамилии.
12. Вывести все имеющиеся самолёты марки Boeing.
13. Вывести модели самолётов, назначенные на рейсы.
14. Вывести пофамильный состав всех экипажей.

## Лабораторная работа №3. создание и использование хранимых процедур и функций <a name="lab3"></a>
Знакомство с возможностями СУБД по созданию хранимых процедур и функций.
### Порядок выполнения работы:
1.	Создайте хранимые процедуры:
a)	без параметров, с использованием агрегатных функций;
b)	с входным параметром/параметрами;
c)	с входными и выходными параметрами.
2.	Создайте хранимые процедуры для добавления и изменения записей в таблицах, проверяющих существование редактируемой записи и определяющие значение суррогатного первичного ключа по умолчанию для новых записей.
3.	Внесите такие изменения в хранимые процедуры добавления и изменения записей в таблицах, которые не позволят добавить или изменить записи с дублирующими названиями.
4.	Создайте хранимые процедуры удаления записей из таблиц, удаляющих связанные записи из дочерних таблиц.
5.	Проверьте работоспособность всех созданных хранимых процедур.
6.	Создайте функцию:
a)	возвращающую скалярное значение (тип функции Scalar);
b)	возвращающую набор данных Table (тип функции Inline);
c)	многооператорную функцию, возвращающую таблицу (тип функции Multi-statement).
7.	Проверьте работоспособность всех созданных функций.

## Лабораторная работа №4. Создание и использование триггеров и курсоров <a name="lab4"></a>
Знакомство с возможностями СУБД по созданию триггеров и курсоров.
### Порядок выполнения работы:
1.	Создайте триггер:
a)	запрещающий вставку в таблицу новой строки с заданным параметром;
b)	запрещающий изменение заданного поля.
2.	Внесите изменения в ранее созданный триггер.
3.	Создайте необходимые последовательности для суррогатных первичных ключей.
4.	Создайте триггеры вставки и изменения записей таблиц, определяющие значение суррогатного первичного ключа по умолчанию.
5.	Создайте триггер ведения аудита изменения записей в таблицах.
6.	Внесите такие изменения в триггеры вставки и изменения записей таблиц, которые не позволят добавить или изменить записи с дублирующими названиями.
7.	Создайте триггеры для не обновляемых представлений, позволяющие изменять данные.
8.	Создайте курсор для вывода записей из таблицы, удовлетворяющих заданному условию.
9.	Создайте курсор, используемый как выходной параметр процедуры.

## Лабораторная работа №5. Разработка системы защиты информации на основе привилегий <a name="lab5"></a>
Знакомство с возможностями СУБД по защите информации на основе привилегий.
### Порядок выполнения работы:
1.	Создайте нового пользователя и предоставьте ему привилегии на выборку информации из созданных вами представлений и запуска процедур.
2.	Соединитесь с СУБД от имени нового пользователя и проверьте возможность доступа к вашим данным через представления и запуск процедур.
3.	Проверьте невозможность доступа к вашим данным через таблицы и хранимые процедуры.
4.	Соединитесь с СУБД от своего имени и предоставьте новому пользователю привилегии на выборку, вставку, изменение и удаление данных из ваших таблиц.
5.	Соединитесь с СУБД от имени нового пользователя и проверьте возможность изменения данных в созданных вами таблицах.
6.	Соединитесь с СУБД от своего имени и отберите у нового пользователя все предоставленные ему привилегии.
7.	Соединитесь с СУБД от имени нового пользователя и проверьте невозможность изменения данных в созданных Вами таблицах и запуск ваших хранимых процедур.

## Распределённая обработка данных в современных СУБД <a name="lab6"></a>

Организация занимается поставками молочной продукции.
Организация характеризуется 
* ИНН, 
* наименованием, 
* телефоном, 
* адресом,
* фамилией директора, 
* фамилией менеджера, ответственного за поставки.

Молочная продукция характеризуется 
* названием, 
* % жирности,
* стоимостью. 

Потребителями продукции являются другие организации, характеризующиеся 
* различным видом собственности (государственные учреждения, муниципальные учреждения, ООО, ОАО, ИП).

### Лабораторная работа №1. Проектирование распределённой базы данных

1. Для заданной предметной области построить ER-модель, выделить
сущности, описать атрибуты каждой сущности, установить связи
между сущностями.
2. Разработать схему базы данных. При необходимости произвести
нормализацию отношений.
3. При построении физической структуры базы данных согласовать
другими вариантами название полей, их идентификаторов и типов
данных для всех сущностей (общие во всех вариантах поля должны
иметь одинаковые идентификаторы)
4. Реализовать полученную схему. При создании дать имя базе данных по имени
соответствующей рабочей станции (например, WS1, WS2 и WS3).
5. Заполнить таблицы данными (не менее 10 записей в каждой балице
базы данных. При этом данные о поставщиках и потребителях не
должны совпадать на разных рабочих станциях).
